<?PHP
$page="salaire.php";
$script="scripts/update_salaire.php";
if ($asm==1){
	$titre="Mes salaires perçus";
	$pageDescription="Liste des salaires perçus";
}else{
	$titre="Mes salaires versés";
	$pageDescription="Liste des salaires versés ou création d'une nouvelle fiche de paie";
}
$pageHelp="
		<b><i>Modifier un salaire</i></b> <br/>						
		Cliquer sur l'icône à droite du numéro de salaire pour l'éditer (<img style=\"cursor: pointer;\" src=\"graphs/icons/edit.png\">).<br/>		
		<br/>	<br/>
		";
$nbSalaire=0;
$nbParent=0;
$disable="";
$tabMois=array("01"=>"Janvier","02"=>"Février","03"=>"Mars","04"=>"Avril","05"=>"Mai","06"=>"Juin","07"=>"Juillet","08"=>"Août","09"=>"Septembre",10=>"Octbore",11=>"Novembre",12=>"Décembre");
if(!isset($_COOKIE["ID_UTILISATEUR"])){
	header("Location: ../index.php");
	exit;
}
include_once("../header.inc.php");
include_once("../include/functions.php");
include_once("../include/protect_var.php");
//entete_page($GLOBALS['params']['appli']['title_appli']." - ".$titre,'');
?>
<style>
.barreTitre{
	font-weight: bold;
	border-top: solid 1px #fff;
	border-left: solid 1px #fff;
	border-right: solid 1px #fff;
}			
</style>
</head>
<body>
<div class="highslide-html-content" id="highslide-html2">
	<div class="highslide-header">	
	</div>
	<div class="highslide-body">
		<?php echo $pageHelp;?>			
	</div>
    <div class="highslide-footer">
        <div>
            <span class="highslide-resize" title="Resize">
                <span></span>
            </span>
        </div>
    </div>
</div>

<div id="container2">
	<h1><?php  echo $titre;?></h1>
		<h2><?php  echo $pageDescription;?></h2>	
		<div id="mess" style="display: none;"></div>
		<div id="help" title="Aide"><a href="#" onclick="return hs.htmlExpand(this, { contentId: 'highslide-html2',headingText: 'Aide' } )"></a></div>
	<div class="content">
		<?php 
		connectSQL();
		$req="SELECT a.*,date_format(a.date, '%M %Y') AS date_salaire_fr,date_format(a.date_reglement, '%d-%m-%Y') AS date_reglement_fr,b.id_asm,c.nom as nom_asm,c.prenom as prenom_asm,d.nom as nom_enfant,d.prenom as prenom_enfant 
		FROM salaire a, contrat b, user c, enfant d WHERE a.id_contrat=b.id AND b.id_asm=c.id AND b.id_enfant=d.id AND (d.id_parent1='$_COOKIE[ID_UTILISATEUR]' OR d.id_parent2='$_COOKIE[ID_UTILISATEUR]' OR c.id='$_COOKIE[ID_UTILISATEUR]') ORDER BY a.date DESC;";
		@mysql_query("SET lc_time_names = 'fr_FR';");		
		$rec=@mysql_query($req); 		
		//echo $req;
		$reqParent="SELECT id FROM parent WHERE id_user='$_COOKIE[ID_UTILISATEUR]';";
		$recParent=@mysql_query($reqParent);
		if (@mysql_num_rows($recParent)>0){			
			$reqContrat="SELECT a.id,a.id_asm,a.id_enfant,a.nb_repas,b.nom as nom_asm,b.prenom as prenom_asm,c.nom as nom_enfant,c.prenom as prenom_enfant,c.id_parent1 as id_parent1,a.valid_parent1 as valid_parent1,c.id_parent2 as id_parent2,a.valid_parent2 as valid_parent2 
			FROM contrat a, user b, enfant c 
			WHERE a.id_enfant=c.id AND a.id_asm=b.id AND (c.id_parent1='$_COOKIE[ID_UTILISATEUR]' OR c.id_parent2='$_COOKIE[ID_UTILISATEUR]') ORDER BY a.date_contrat;";			
			$recContrat=@mysql_query($reqContrat);			
			if (@mysql_num_rows($recContrat)==0){
				echo "Vous n'avez pas créé de contrat, la création d'un salaire est impossible !<br/>";
				$masqueAdd=1;			
			}					
		}else{$masqueAdd=1;}		
		//echo $reqContrat;
		?>		
		<div <?php if ($masqueAdd==1){echo 'style="display: none;"';}?>>
		<p style="cursor: pointer;text-decoration: underline;margin:0 ;padding: 0;" onclick="affiche('addSalaire','');afficheSi('validButton','nbSalaire');"><img src="graphs/icons/add16.png">&nbsp;Ajouter un salaire</p>
		</div>
		<div style="display: none" id="addSalaire">
			<form method="post" id="myForm" action="#">
			<input type="hidden" name="page" value="<?php echo $page;?>">
			<table style="width: 100%">																				
				<tr><td style="width:110px;">Contrat</td><td><select name="contrat<?php echo $nbSalaire;?>">
					<option></option>
					<?php
					while ($resContrat= @mysql_fetch_array($recContrat)){
						echo "<option value=\"$resContrat[id]\">$resContrat[id] - $resContrat[prenom_enfant] $resContrat[nom_enfant] et $resContrat[prenom_asm] $resContrat[nom_asm]</option>";
					} 
					?>										
					</select></td>
				</tr>	
				<tr><td>Période :</td></tr>
				<tr>
					<td colspan=2 align="left">				
					<div class="MonthPicker" id="example_1" title="Sélectionner une année"></div>				
				<!-- <select name="<?php echo $nbSalaire;?>">
					<option></option>
					<?php
					while ($resLien=@mysql_fetch_array($recLien)){
						echo "<option value=\"$resLien[id]\">$resLien[prenom] $resLien[nom]</option>";
					} 
					?>										
					</select> --></td>
				</tr>				
			</table>
			<p id="validButtonAdd"><button type="submit" id="submitButtonAdd" name="add" value="Valider" style="cursor: pointer;">Valider</button></p>
			<input type="hidden" name="date<?php echo $nbSalaire;?>" value="<?php echo date('Y-m')."-01";?>" id="message_example_1">
			<input type="hidden" name="nbSalaire" id="nbSalaire" value="<?php echo $nbSalaire;?>">
			</form>
		</div>
			<div id="majSalaire">	
			<table style="width: 100%" style="margin: 0;padding:0;" cellspacing=0 cellpadding=0>		
			<tr><th width="40px" class="barreTitre">N°</th>
			<th class="barreTitre">Période</th>
			<th width="10px" class="barreTitre">Contrat</th>
			<th class="barreTitre">Enfant</th>
			<th class="barreTitre">AM</th>
			<th class="barreTitre">Réglé le</th>
			<th class="barreTitre">Salaire Net</th>
			<th colspan=3 width="48px">&nbsp;</th></tr>
			<?php 
			$tabTypeContrat=array(1=>"10% mensuel",2=>"En une seule fois",3=>"Lors de la prise des congés");
			while ($res=@mysql_fetch_array($rec)){				
				$nbSalaire++;
				//Nombre de jours dans le mois
				$date=explode('-',$res['date']);
				$Annee = $date[0];
				$Mois = $date[1];
				$jouReglement=mktime(0,0,0,$Mois,$resInfo['jour_reglement'],$Annee);
				if ($res['valid_asm']>0){
					$disable=" readonly";
				}												
					
				$reqInfo="SELECT id,heures_gardes,salaire_horaire_brut,salaire_horaire_net,nb_repas,salaire_heure_supp,declenchement_supp,salaire_heure_comp,declenchement_comp,
				indemnite_entretien,indemnite_repas,date_format(date_contrat,'%d-%m-%Y') as date_contrat,date_format(date_fin_contrat,'%d-%m-%Y') as date_fin_contrat,jour_reglement,nb_sem_travail,nb_jour_sem,emploi,conges_payes,indemnite_kilometrique,type_contrat FROM contrat WHERE id='$res[id_contrat]'";
				$resInfo=mysql_fetch_array(mysql_query($reqInfo));
				$infoUser="<table>
				<caption style='background-color: #0F3F6F;color: #fff;'>Contrat N°$res[id_contrat]</caption>
				<tr><td>Intitulé du poste</td><td>&nbsp;:&nbsp;$resInfo[emploi]</td></tr>
				<tr><td>Jour de réglement</td><td>&nbsp;:&nbsp;le $resInfo[jour_reglement]</td></tr>
				<tr><td>Heures hebdomadaires (en h)</td><td>&nbsp;:&nbsp;$resInfo[heures_gardes]</td></tr>
				<tr><td>Semaines travaillées (par an)</td><td>&nbsp;:&nbsp;$resInfo[nb_sem_travail]</td></tr>
				<tr><td>Jours hebdomadaires</td><td>&nbsp;:&nbsp;$resInfo[nb_jour_sem]</td></tr>
				<tr><td>Taux horaire brut</td><td>&nbsp;:&nbsp;$resInfo[salaire_horaire_brut]</td></tr>
				<tr><td>Taux horaire net</td><td>&nbsp;:&nbsp;$resInfo[salaire_horaire_net]</td></tr>
				<tr><td>Taux heure complémentaire</td><td>&nbsp;:&nbsp;$resInfo[salaire_heure_comp]</td></tr>
				<tr><td>Heure complémentaire au delà de (en h)</td><td>&nbsp;:&nbsp;$resInfo[declenchement_comp]</td></tr>
				<tr><td>Taux heure supplémentaire</td><td>&nbsp;:&nbsp;$resInfo[salaire_heure_supp]</td></tr>
				<tr><td>Heure suplémentaire au delà de (en h)</td><td>&nbsp;:&nbsp;$resInfo[declenchement_supp]</td></tr>
				<tr><td>Indemnité d'entretien</td><td>&nbsp;:&nbsp;$resInfo[indemnite_entretien]</td></tr>
				<tr><td>Indemnité de repas</td><td>&nbsp;:&nbsp;$resInfo[indemnite_repas]</td></tr>
				<tr><td>Indemnité kilométrique</td><td>&nbsp;:&nbsp;$resInfo[indemnite_kilometrique]</td></tr>
				<tr><td>Le contrat débute le</td><td>&nbsp;:&nbsp;$resInfo[date_contrat]</td></tr>
				<tr><td>Le contrat termine le</td><td>&nbsp;:&nbsp;$resInfo[date_fin_contrat]</td></tr>
				<tr><td>Paiement congés payés</td><td>&nbsp;:&nbsp;".$tabTypeContrat[$resInfo[conges_payes]]."</td></tr>
				<tr><td>Type de contrat</td><td>&nbsp;:&nbsp;$resInfo[type_contrat]</td></tr>
				</table>
				";				
				if ($nbSalaire%2 == 0){
					$color='#f7f7f7';
				}else{$color='#c7c7c7';
				}
				if (date('Y-m-d')>date('Y-m-d',$jouReglement)){
					$colorDate="background-color: #E86161;border: solid 1px #000;cursor: help;";$titleDate="Non réglé à la date prévue !";
				}else{$colorDate=$color;$titleDate="";
				}
				$onclickEdit="onclick=\"affiche('salaire$res[id]','tr_salaire$res[id]');\"";
				echo "<tr bgcolor=\"$color\" style=\"color: #000;cursor: pointer;\" onMouseOver=\"this.bgColor='#f4d99e'\" onMouseOut=\"this.bgColor='$color'\">
				<td style=\"text-align: center;\" $onclickEdit>$res[id]</td>
				<td style=\"text-align: center;\" $onclickEdit>$res[date_salaire_fr]</td>
				<td style=\"text-align: center;\" $onclickEdit><img src=\"graphs/icons/contrat.png\" title=\"$infoUser\" style=\"cursor: help;\"></td>
				<td style=\"text-align: left;\" $onclickEdit>$res[prenom_enfant] $res[nom_enfant]</td>
				<td style=\"text-align: left;\" $onclickEdit>$res[prenom_asm] $res[nom_asm]</td>
				<td style=\"text-align: center;$colorDate\" title=\"$titleDate\" $onclickEdit>$res[date_reglement_fr]</td>
				<td style=\"text-align: right;\" $onclickEdit id=\"salaire_net2_$res[id]\">$res[salaire_net]</td>
				<td style=\"text-align: center;width: 32px;\"><img style=\"cursor: pointer;\" src=\"graphs/icons/edit.png\" title=\"Modifier cette fiche de paie\" onclick=\"affiche('salaire$res[id]','tr_salaire$res[id]');\"></td>
				<td style=\"text-align: center;width: 32px;\">";
				if (!empty($res['salaire_net'])){
					echo "
					<form method=\"post\" action=\"main/pdf.php\" style=\"display: inline; margin:0 padding:0;\" target=\"_blank\">
					<input type=\"hidden\" name=\"id_salaire\" value=\"$res[id]\">
					<input type=\"hidden\" name=\"id_contrat\" value=\"$res[id_contrat]\">
					<input type=\"submit\" name=\"edit\" value=\"\" style=\"background-image: url(graphs/icons/print.png);
					background-repeat:no-repeat;
					background-color: transparent;border: none;
					cursor: pointer;\" title=\"Imprimer ou editer cette fiche de paie\">";
					echo "</form>";
				}
				echo "<img style=\"cursor: pointer;\" src=\"graphs/icons/print.png\" title=\"Imprimer cette fiche de paie\" onclick=\"affiche('salaire$res[id]','tr_salaire$res[id]');\"></td>
				<td style=\"text-align: center;width: 32px;\">";				
				if (empty($disable)){
					echo "<form method=\"post\" style=\"display: inline;margin: 0; padding:0;margin-left: 5px;\">";
					echo "<input type =\"hidden\" name=\"id\" value=\"$res[id]\">";
					echo "<input type=\"submit\" name=\"del\" value=\"\" style=\"background-image: url(graphs/icons/supp.png);
					background-repeat:no-repeat;
					background-color: transparent;border: none;
					cursor: pointer;\" title=\"Supprimer cette fiche de paie\" onclick=\"
					return(confirm('Voulez-vous vraiment supprimer cette fiche de paie ?'));
					\">";
					echo "</form>";
				}
				echo "</td></tr>
				";
				/*echo "<table style=\"width: 100%;display: none;\">	";
				echo "<tr><td colspan=2 class=\"separ\"><div class=\"";
				if (date('Y-m-d')>date('Y-m-d',$jouReglement)){
					echo "identifiantErr";$msg="Non réglé à la date prévue !";
				}else{echo "identifiant";$msg="";
				}
				echo "\">Salaire N° $res[id] : $res[date_salaire_fr]</div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$msg";				
				echo "
				<div class=\"infoLien\">";				
				if (empty($disable)){
					echo "<form method=\"post\" class=\"myFormDelete\" action=\"#\" style=\"display: inline\">";
					echo "<input type =\"hidden\" name=\"id\" value=\"$res[id]\">";
					echo "<input type=\"submit\" name=\"del\" value=\"\" style=\"background-image: url(graphs/icons/supp.png);
					background-repeat:no-repeat;					
					background-color: transparent;border: none;
					cursor: pointer;\" title=\"Supprimer cette fiche de paie\" onclick=\"
					return(confirm('Voulez-vous vraiment supprimer cette fiche de paie ?'));					
					\">&nbsp;&nbsp;&nbsp;";
					echo "</form>";
				}
				echo "<img style=\"cursor: pointer;\" src=\"graphs/icons/edit.png\" title=\"Modifier cette fiche de paie\" onclick=\"affiche('salaire$res[id]');\">
				</div></td></tr>";
				echo "<tr><td style=\"width: 130px;\">Basé sur le contrat</td><td>:&nbsp;<img src=\"graphs/icons/contrat.png\" title=\"$infoUser\" style=\"cursor: help;\"></td></tr>";
				echo "<tr><td style=\"width: 130px;\">Enfant</td><td>:&nbsp;$res[prenom_enfant] $res[nom_enfant]</td></tr>";				
				echo "<tr><td style=\"width: 130px;\">";				
				if ($res['id_asm']==$_COOKIE['ID_UTILISATEUR']){
						$valid="valid_asm";$disable=" readonly";
					}
				echo "Assistante maternelle</td><td>:&nbsp;$res[prenom_asm] $res[nom_asm]</td></tr>";																							
				echo "</table>";					*/
				// Construit un tableau contenant les jours fériés de l'année en cours				
				$PaquesDim = easter_date($Annee);
				$PaquesLun = date("Y-m-d", ($PaquesDim + 24*3600));
				$PentecoteLun = date("Y-m-d", ($PaquesDim + 50*24*3600));
				$AscensionJeu = date("Y-m-d", ($PaquesDim + 39*24*3600));
				$JoursFeries = array("$Annee-01-01", "$Annee-05-01", "$Annee-05-08", "$Annee-07-14",
						"$Annee-08-15", "$Annee-11-01", "$Annee-11-11", "$Annee-12-25", "$PaquesLun",
						"$AscensionJeu", "$PentecoteLun");
				
				// Calcul du nombre de jours ouvrés
				//$Mois = date('m');
				$dateSalaire = mktime( 0, 0, 0, $Mois, 1, $Annee );
				$NbJours = date('t',$dateSalaire);				
				$JoursTravaillesPasses = 0;
				$JoursTravaillesFuturs = 0;				
				for($i=1; $i<=$NbJours; $i++) {
				
					$DateJour = mktime(0, 0, 0, $Mois, $i, $Annee);
					$JourSemaine = date('D', $DateJour);
					if(!in_array(date("Y-m-d",$DateJour), $JoursFeries) && $JourSemaine != 'Sun' &&
							$JourSemaine != 'Sat' ) {
						if($DateJour <= $dateSalaire) {
							$JoursTravaillesPasses++;
						} else {
							$JoursTravaillesFuturs++;
						}
					}
				}
				
				$JoursTravaillesMois = $JoursTravaillesPasses + $JoursTravaillesFuturs;
				$nbHeureJour=$resInfo[heures_gardes]/$resInfo[nb_jour_sem];
				echo "<tr id=\"tr_salaire$res[id]\" style=\"display: none;\"><td colspan=9>";
				echo "<div id=\"salaire$res[id]\" style=\"display: none;\">";
				echo "<form method=\"post\" id=\"formEdit$res[id]\" class=\"editForm\" action=\"#\" style=\"display: inline; margin:0 padding:0;\">";
				echo "<input type =\"hidden\" name=\"id\" value=\"$res[id]\">";
				echo "<input type =\"hidden\" name=\"id_contrat\" value=\"$res[id_contrat]\">";
				echo "<input type =\"hidden\" name=\"validName\" value=\"$valid\">";
				echo "<input type =\"hidden\" name=\"mois\" value=\"$Mois\">";
				echo "<input type =\"hidden\" name=\"annee\" value=\"$Annee\">";
				echo "<input type =\"hidden\" name=\"nbHeureJour\" value=\"$nbHeureJour\">";
				echo "<table width=\"100%\">";				
				include('cal_day.php');
				echo "<tr>
				<td style=\"width: 150px;\">Heure(s) effectuée(s)</td><td id=\"heures_mois_$res[id]\">:&nbsp;$res[heure_mois]<!--<br/><i>heures théoriques : ".$nbHeureJour*$JoursTravaillesMois." ($JoursTravaillesMois jours ouvrables * $nbHeureJour heures d'accueil)</i>--></td>								
				<td colspan=2>Repas pris</td><td id=\"repas_mois_$res[id]\">:&nbsp;$res[repas_mois]</td>
				</tr>";				
				echo "<tr>
				<td>Jour(s) travaillé(s)</td><td id=\"jour_mois_$res[id]\">:&nbsp;$res[jour_mois]</td>				
				<td colspan=2>Congé(s) pris</td><td id=\"conge_mois_$res[id]\">:&nbsp;$res[conge_mois]</td>		
				</tr>";
				echo "<tr>
				<td>Semaine(s) travaillée(s)</td><td id=\"semaines_travaillees_$res[id]\">:&nbsp;$res[semaines_travaillees]</td>					
				<td colspan=2>Absence enfant justifiée</td><td id=\"absence_enfant_$res[id]\">:&nbsp;$res[absence_enfant]</td>			
				</tr>";
				echo "<tr>
				<td>Heure(s) complémentaire(s)</td><td id=\"heure_comp_mois_$res[id]\">:&nbsp;$res[heure_comp_mois]</td>
				<td colspan=2>Abscence pour convenance de l'AM</td><td id=\"jour_formation_asm_$res[id]\">:&nbsp;$res[jour_formation_asm]</td>
				</tr>";
				echo "<tr><td>Heure(s) supplémentaire(s)</td><td id=\"heure_supp_mois_$res[id]\">:&nbsp;$res[heure_supp_mois]</td></tr>";													
				echo "<tr>
				<td title=\"Montant en € d'une régularisation à verser ou à débiter à l'AM \">Régularisation</td><td>:&nbsp;<input $disable size=4 name=\"salaire_regul\" value=\"$res[salaire_regul]\"></td>
				<td>Date du réglement</td><td>:&nbsp;";
				echo '<input '.$disable.' style="vertical-align: middle;" readonly type="text" size=6 name="date_reglement" id="data'.$res[id].'" value="'.$res['date_reglement'].'">
				<img src="graphs/icons/cal.png" id="f_trigger_a'.$res[id].'"
				style="text-align: left;cursor: pointer; vertical-align: middle; margin: 0;pading: 0;"
				title="Choisissez une date"
				onmouseover="this.style.background=\'blue\';"
				onmouseout="this.style.background=\'\'"/>
				<script type="text/javascript">
				Calendar.setup({
					inputField     :    "data'.$res[id].'",
					ifFormat       :    "%Y-%m-%d",
					button         :    "f_trigger_a'.$res[id].'",
					singleClick    :    true
				});
				</script></td>';
				echo "<td>Mode du réglement</td><td>:&nbsp;<select name=\"mode_reglement\" $disable style=\"width: 90px;\">";
				if (empty($disable)){
					echo "<option></option>";
					$reqAsm="SELECT CB,CHQ,VIR,ESP,CESU FROM asm WHERE id_user=$res[id_asm]";
					$recAsm=mysql_query($reqAsm);
					$resAsm=mysql_fetch_array($recAsm);
					$tabMode=array('CB'=>'Catre bleue','CHQ'=>'Chéque','VIR'=>'Virement bancaire','ESP'=>'Espéces','CESU'=>'Tickets CESU');
					foreach ($tabMode as $moyenPaiement=>$textePaiement){
						if ($resAsm[$moyenPaiement]==1){
							echo "<option value=\"$moyenPaiement\"";
							if ($res['mode_reglement']==$moyenPaiement){
								echo " selected";
							}
							echo ">$textePaiement</option>";
						}
					}
				}else{
					echo "<option value=\"$res[mode_reglement]\">$res[mode_reglement]</option>";
				}
				echo "</select></td>
				</tr>";
				echo "<tr></tr>";				
				echo "<tr></tr>";
				echo "<tr><td colspan=6 style=\"border-bottom: solid 2px #fff;height:1px;\"></td</tr>";
				echo "<tr><td colspan=6 style=\"text-align: right;font-weight: bold;font-size:larger;\">Salaire net : <p id=\"salaire_net1_$res[id]\" style=\"margin:0 padding:0;display: inline;color: #fff;\">$res[salaire_net]</p>&nbsp;€
				<!--<input type=\"hidden\" $disable size=5 name=\"salaire_net\" value=\"$res[salaire_net]\">-->
				</td></tr>";
				echo "</table>";
				echo "<button type=\"submit\" name=\"valid\" value=\"Valider\" style=\"cursor: pointer;\">Valider</button>";
				echo"</form>";
				if (!empty($res[heure_mois]) && !empty($res[jour_mois]) && !empty($res[semaines_travaillees])){
					$affCalcul="style=\"display: ;";}else{$affCalcul="style=\"display: none;";}				
				echo "<form method=\"post\" action=\"main/pdf.php\" style=\"display: inline; margin:0 padding:0;\" target=\"_blank\">
				<input type=\"hidden\" name=\"id_salaire\" value=\"$res[id]\">
				<input type=\"hidden\" name=\"id_contrat\" value=\"$res[id_contrat]\">
				<button type=\"submit\" name=\"pdf\" id=\"genPDF\" value=\"Génére le fichier PDF\" style=\"cursor: pointer;\">Imprimer</button>
				</form>";
				echo "</div></td></tr>";
			}
			?>
			</table>
		</div>
		<!-- <div class="formLeft">
			<table>
			<tr><td></td><td></td></tr>		
			</table>
		</div>
		<div class="formRight">
			<table>
			<tr><td></td><td></td></tr>		
			</table>
		</div> -->		
	</div>
</div>
<script type="text/javascript">
jQuery(document).ready(function(){
	jQuery("input").focus(function() {
		jQuery("#mess").hide();
	});
	jQuery('.calculForm').each( function(){			
		jQuery(this).validate({					
			debug: false,			
			submitHandler: function(form) {			
				var datas = jQuery(form).serialize();				
				var data = {};				
				$(form).find('input[name=id_salaire]').each(function(i, field) {
				    data[field.name] = field.value;
				});
				var id = data['id_salaire'];		       
				jQuery("#mess").hide();				
	            jQuery.ajax({
	                cache: false,
	                type: 'POST',
	                data: datas,
	                url : 'scripts/calculate.php',
	                success: function (response) {                    
	                    jQuery("#mess").attr('class','mess');
	                    jQuery("#mess").show(1500);	                    
	                    var exp=new RegExp("^[0-9]","g");
	                    if (exp.test(response)){
	                    	jQuery("#salaire_net1_"+id).html(response);
	                    	jQuery("#salaire_net2_"+id).html(response);
	                    }else{
	                    	jQuery("#mess").html(response);
	                    }	                    
	                },
	                error: function(data, textStatus, jqXHR) {
	                	jQuery("#mess").attr('class','messErr');
	                    jQuery("#mess").show(1500);
	                    jQuery("#mess").html(data);                	
	                }
	            })
			}
		});
	});	
	jQuery('#myForm').each( function(){
		jQuery(this).validate({			
			debug: false,
			rules: {
				/*uniqId0: "required",*/
				contrat0: {
					required: function(element) {
						return jQuery("#addSalaire").is(":visible");
					}
				},
				date0: {
					required: function(element) {
						return jQuery("#addSalaire").is(":visible");
					}
				}			
			},
			messages: {
				contrat0: "Vous devez sélectionner un contrat existant",
				date0: "Vous devez sélectionner le mois et l'année du salaire",				
			},
			submitHandler: function(form) {			
				var datas = jQuery(form).serialize();		
	            jQuery.ajax({
	                cache: false,
	                type: 'POST',
	                data: datas,
	                url : '<?php echo $script;?>',
	                success: function (response) {                    
	                    jQuery("#mess").attr('class','mess');
	                    jQuery("#mess").show(1500);
	                    if (response=="Enregistrement effectué"){	                    			                                   
		                    jQuery("#container").load('main/<?php echo $page;?>');		                    
	                    }
	                    jQuery("#mess").html(response);
	                },
	                error: function(data, textStatus, jqXHR) {
	                	jQuery("#mess").attr('class','messErr');
	                    jQuery("#mess").show(1500);
	                    jQuery("#mess").html("data");                	
	                }
	            })
			}
		});
	});
	
	jQuery('.myFormDelete').each( function(){
		jQuery(this).validate({
			debug: false,		
			submitHandler: function(form) {			
				var datas = jQuery(form).serialize();		
	            jQuery.ajax({
	                cache: false,
	                type: 'POST',
	                data: datas,
	                url : '<?php echo $script;?>',
	                success: function (response) {                    
	                    jQuery("#mess").attr('class','mess');
	                    jQuery("#mess").show(1500);
	                    if (response=="Suppression effectuée"){	                    			                           
		                    jQuery("#container").load('main/<?php echo $page;?>');		                    
	                    }
	                    jQuery("#mess").html(response);
	                },
	                error: function(data, textStatus, jqXHR) {
	                	jQuery("#mess").attr('class','messErr');
	                    jQuery("#mess").show(1500);
	                    jQuery("#mess").html("data");                	
	                }
	            });
			}
		});
	});	
	
	jQuery.extend(jQuery.validator.messages, {
		required: "Ce champ est obligatoire !",
		number: "Ce champ ne peut contenir que des chiffres"
		});
	jQuery('.editForm').each( function(){
		jQuery(this).validate({	
			debug: false,
			rules: {
				heure_mois: {
					required: true,
					number: true
				},
				heure_supp_mois: {				
					number: true
				},
				heure_comp_mois: {
					number: true
				},			
				jour_mois: {
					required: true,				
					number: true
				},
				conge_mois: {					
					number: true
				},
				repas_mois: {
					number: true
				},
				jour_formation_asm: {				
					number: true
				},
				semaines_travaillees: {
					required: true,				
					number: true
				}						
			},
				
			submitHandler: function(form) {
				var datas = jQuery(form).serialize();	
				var data = {};				
				$(form).find('input[name=id]').each(function(i, field) {
				    data[field.name] = field.value;
				});
				var id = data['id'];	
	            jQuery.ajax({
	                cache: false,
	                type: 'POST',
	                data: datas,
	                url : '<?php echo $script;?>',
	                success: function (response) {   		                                
	                    jQuery("#mess").attr('class','mess');
	                    jQuery("#mess").show(1500);
	                    jQuery("#mess").html(response);
	                    //var exp=new RegExp("^[0-9]","g");
	                    var exp=new RegExp("^[!]","g");	                    
	                    if (exp.test(response)){	                    	
	                    	response = response.substring(1);
	                    	var myArray = response.split('@@');	                  	
	                    	for (var i=0;i<myArray.length;i++){
	                    		var myArray2 = myArray[i].split('#');	                    		
	                    		if (myArray2[0]=="salaire_net"){	                    			
	                    			jQuery("#salaire_net1_"+id).html(": "+myArray2[1]);
	                    			jQuery("#salaire_net2_"+id).html(": "+myArray2[1]);
	                    		}else{	                    			
	                    			jQuery("#"+myArray2[0]+"_"+id).html(": "+myArray2[1]);
	                    		}
	                    	}		                    	                    	
	                    	//jQuery("#salaire_net2_"+id).html(response);
	                    	jQuery("#mess").html("Enregistrement effectué");
	                    }else{
	                    	if (response=="Enregistrement effectué"){	                    	
			                    jQuery("#calculSalaire").show();		                   		                    		                   
		                    }
	                    	jQuery("#mess").html(response);
	                    }	                    
	                },
	                error: function(data, textStatus, jqXHR) {
	                	jQuery("#mess").attr('class','messErr');
	                    jQuery("#mess").show(1500);
	                    jQuery("#mess").html("data");                	
	                }
	            })
			}
		});
	});
});
jQuery(document).ready( function() {
    jQuery("img[title]").tooltip({
		// tweak the position
        offset: [0, 0],
        // use the "slide" effect        
        //position: 'bottom right' ,
        effect: 'slide'              
        // add dynamic plugin with optional configuration for bottom edge
    }).dynamic({ bottom: { direction: 'down', bounce: true } });    
});
function eraseTable(NbJours,idSalaire){
	for (i=1;i<=NbJours;i++){		
		jQuery("#heure_"+i+"_"+idSalaire).val("");
		jQuery("#repas_"+i+"_"+idSalaire).val("");
		jQuery("#conges_"+i+"_"+idSalaire).val("");
		jQuery("#abs_enfant_"+i+"_"+idSalaire).val("");
		jQuery("#abs_asm_"+i+"_"+idSalaire).val("");
	}
}
</script>
<link rel="stylesheet" href="content/monthpicker/monthpicker.css" type="text/css" charset="utf-8" />
<script type="text/javascript" src="content/monthpicker/monthpicker.min.js"></script>
<script type="text/javascript">
jQuery(function(){		
	$("#example_1").monthpicker(callback);	
});
function callback(data,$e){	
	var str = "";
	for(key in data) {		
		str += data[key]+'-';
	}
	str+='01';	
	jQuery('#message_example_1').val(str);
	/*var selector = "#message_" + $e.attr('id');
	$(selector).prepend("{" + str + "};<br />").show();*/
}
</script>
</body>
</html>